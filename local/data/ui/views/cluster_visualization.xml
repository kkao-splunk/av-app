<form script="namespacesearch.js">
  <label>cluster_visualization</label>
  <fieldset autorun="true" submitButton="false" autoRun="true">
    <input type="dropdown" token="cluster_tok" searchWhenChanged="true">
      <label>Select a cluster</label>
      <fieldForLabel>avanti</fieldForLabel>
      <fieldForValue>name</fieldForValue>
      <search>
        <query>index = avanti | stats first(name) BY name | table name</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>Provider</title>
      <viz type="status_indicator_app.status_indicator">
        <search>
          <query>index = avanti name=$cluster_tok$| stats count by provider.name</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="status_indicator_app.status_indicator.colorBy">static_color</option>
        <option name="status_indicator_app.status_indicator.fillTarget">background</option>
        <option name="status_indicator_app.status_indicator.fixIcon">warning</option>
        <option name="status_indicator_app.status_indicator.icon">fix_icon</option>
        <option name="status_indicator_app.status_indicator.precision">0</option>
        <option name="status_indicator_app.status_indicator.showOption">3</option>
        <option name="status_indicator_app.status_indicator.staticColor">#555</option>
        <option name="status_indicator_app.status_indicator.useColors">true</option>
        <option name="status_indicator_app.status_indicator.useThousandSeparator">true</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.size">small</option>
        <option name="trellis.splitBy">_aggregation</option>
      </viz>
    </panel>
    <panel>
      <title>Status</title>
      <viz type="status_indicator_app.status_indicator">
        <search>
          <query>index = avanti name=$cluster_tok$| stats latest(status) AS status BY name | eval color_tok = if(status == "active","#a2cc3e", "#d6563c") | table status color_tok</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="status_indicator_app.status_indicator.colorBy">field_value</option>
        <option name="status_indicator_app.status_indicator.fillTarget">background</option>
        <option name="status_indicator_app.status_indicator.fixIcon">bug</option>
        <option name="status_indicator_app.status_indicator.icon">field_value</option>
        <option name="status_indicator_app.status_indicator.precision">3</option>
        <option name="status_indicator_app.status_indicator.showOption">3</option>
        <option name="status_indicator_app.status_indicator.staticColor">#65a637</option>
        <option name="status_indicator_app.status_indicator.useColors">true</option>
        <option name="status_indicator_app.status_indicator.useThousandSeparator">true</option>
      </viz>
    </panel>
  </row>
  <row>
    <panel>
      <single>
        <title>Tasks Pending</title>
        <search>
          <query>index = avanti name=$cluster_tok$| table clusterTasks.pending</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x65a637","0x6db7c6","0xf7bc38","0xd93f3c"]</option>
        <option name="rangeValues">[0,4,7]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Tasks Running</title>
        <search>
          <query>index = avanti name=$cluster_tok$| table clusterTasks.running</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x65a637","0x6db7c6","0xf7bc38","0xd93f3c"]</option>
        <option name="rangeValues">[0,4,10]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <single>
        <title>Number of Services</title>
        <search>
          <query>index = avanti name=$cluster_tok$| table clusterTasks.services</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x65a637","0x6db7c6","0xf7bc38","0xd93f3c"]</option>
        <option name="rangeValues">[0,4,10]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Number of Total Instances</title>
        <search>
          <query>index=avanti name=$cluster_tok$ | table clusterTasks.instances</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
          <refresh>30s</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x65a637","0x6db7c6","0xf7bc38","0xd93f3c"]</option>
        <option name="rangeValues">[0,4,10]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Min number of instances</title>
        <search>
          <query>index = avanti name=$cluster_tok$ | table instanceSettings.number.min</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x65a637","0x6db7c6","0xf7bc38","0xd93f3c"]</option>
        <option name="rangeValues">[0,4,10]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Max number of instances</title>
        <search>
          <query>index = avanti name=$cluster_tok$ | table instanceSettings.number.max</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x65a637","0x6db7c6","0xf7bc38","0xd93f3c"]</option>
        <option name="rangeValues">[0,4,10]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <title>Memory Reservation</title>
      <chart>
        <title>Free Memory Available (in MiB)</title>
        <search>
          <query>index=avanti | spath output=myfield path=resources{}.name | spath output=myfield1 path=resources{}.total | spath output=myfield2 path=resources{}.available  |eval indexx = mvindex(myfield,1) , TotalMemory = mvindex(myfield1,1), available = mvindex(myfield2,1) |search name=$cluster_tok$ indexx = MEMORY| eval UsedMemory = TotalMemory - available| dedup _time| sort -_time desc | table _time TotalMemory available</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.chart">line</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
    <panel>
      <title>CPU Reservation</title>
      <chart>
        <title>Free CPU available (in CPU units)</title>
        <search>
          <query>index=avanti | spath output=myfield path=resources{}.name | spath output=myfield1 path=resources{}.total | spath output=myfield2 path=resources{}.available | eval indexx = mvindex(myfield,0) , TotalCPU = mvindex(myfield1,0), available = mvindex(myfield2,0) | eval UsedCPU = TotalCPU - available |search name=$cluster_tok$ indexx = CPU |eval _time=strftime(_time,"%m/%d/%Y %H:%M:%S") |dedup _time| sort -_time desc | table _time TotalCPU available</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.drilldown">none</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <html>
        <div id="placeholder"> </div>
      </html>
    </panel>
  </row>
</form>